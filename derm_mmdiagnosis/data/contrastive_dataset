# data/contrastive_dataset.py
"""
contrastive_dataset.py
----------------------
(Section “End‑to‑End Pipeline (One‑Page Recipe)” – SimCLR stage)
Defines two‑view datasets for SimCLR:
  • ContrastiveImageFolder for the priority subset.
  • FullContrastiveDataset for full‑train SimCLR pre‑training.
Used by `training/train_simclr.py` and `training/train_simclr_full.py`.
"""








from torch.utils.data import Dataset
from torchvision.datasets import ImageFolder



class FullContrastiveDataset(Dataset):
    """
    Wrap an ImageFolder to produce two transformed views per sample,
    for SimCLR-style training.
    """
    def __init__(self, folder_ds: ImageFolder, transform):
        """
        Args:
            folder_ds: an instance of torchvision.datasets.ImageFolder
            transform: a torchvision.transforms.Compose that applies
                       the desired augmentations
        """
        self.folder = folder_ds
        self.transform = transform

    def __len__(self):
        return len(self.folder)

    def __getitem__(self, idx):
        img, _ = self.folder[idx]   # discard the class label
        # return two independent transforms of the same image
        return self.transform(img), self.transform(img)
